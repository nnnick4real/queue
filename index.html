<!--
  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
  â•‘  Tesla å°åŒ—äº¤ä»˜ä¸­å¿ƒ | è™Ÿç¢¼ç‰Œå«è™Ÿç³»çµ±              â•‘
  â•‘  Version 2.0  â€” Tesla.com Design              â•‘
  â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
  â•‘  Views (é€é URL åƒæ•¸åˆ‡æ›):                    â•‘
  â•‘  - è»Šä¸»ç«¯ (é è¨­):  ?mode=kiosk                â•‘
  â•‘  - ç®¡ç†ç«¯:         ?mode=admin                â•‘
  â•‘  - é›»è¦–çœ‹æ¿:       ?mode=tv                   â•‘
  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-->
<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Tesla å°åŒ—äº¤ä»˜ä¸­å¿ƒ | è™Ÿç¢¼ç‰Œç³»çµ±</title>
    <meta name="description" content="Tesla å°åŒ—äº¤ä»˜ä¸­å¿ƒæ•¸ä½è™Ÿç¢¼ç‰Œå«è™Ÿç³»çµ±">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- Firebase SDK (compat ç‰ˆæœ¬) -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    <!-- QRCode.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

    <style>
        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           Tesla Design System â€” Tesla.com é¢¨æ ¼
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        *,
        *::before,
        *::after {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --white: #ffffff;
            --black: #171a20;
            --gray-100: #f4f4f4;
            --gray-200: #e0e0e0;
            --gray-400: #999;
            --gray-600: #5c5e62;
            --gray-800: #3e4044;
            --red: #e82127;
            --red-dark: #cc171d;
            --green: #3e9142;
            --amber: #b36200;
            --radius-sm: 4px;
            --radius: 8px;
            --radius-lg: 12px;
            --transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.08);
            --shadow: 0 4px 16px rgba(0, 0, 0, 0.12);
            --shadow-lg: 0 8px 32px rgba(0, 0, 0, 0.16);
        }

        body {
            font-family: 'Inter', -apple-system, 'Helvetica Neue', Arial, sans-serif;
            background: var(--white);
            color: var(--black);
            min-height: 100vh;
            min-height: 100dvh;
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
        }

        .view {
            display: none;
            min-height: 100vh;
            min-height: 100dvh;
        }

        .view.active {
            display: flex;
        }

        .screen {
            display: none;
        }

        .screen.active {
            display: flex;
        }

        /* â”€â”€ Tesla Logo SVG â”€â”€ */
        .tesla-logo {
            display: block;
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           CONFIG ERROR
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        #screen-error {
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 40px 24px;
            text-align: center;
            background: var(--white);
        }

        #screen-error.active {
            display: flex;
        }

        #screen-error h1 {
            font-size: 22px;
            font-weight: 500;
            margin: 20px 0 12px;
            color: var(--black);
        }

        #screen-error p {
            color: var(--gray-600);
            max-width: 480px;
            line-height: 1.7;
            font-size: 14px;
        }

        #screen-error code {
            display: block;
            background: var(--gray-100);
            border-radius: var(--radius);
            padding: 16px;
            margin-top: 20px;
            text-align: left;
            font-size: 12px;
            color: var(--gray-800);
            white-space: pre;
            overflow-x: auto;
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           å…±ç”¨å…ƒä»¶
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            border: none;
            border-radius: var(--radius-sm);
            font-family: inherit;
            font-weight: 500;
            font-size: 14px;
            cursor: pointer;
            transition: var(--transition);
            user-select: none;
            -webkit-tap-highlight-color: transparent;
            letter-spacing: 0.3px;
        }

        .btn:active {
            transform: scale(0.97);
        }

        /* Tesla ä¸»è¦æŒ‰éˆ• â€” é»‘åº•ç™½å­— */
        .btn-primary {
            background: var(--black);
            color: var(--white);
            padding: 13px 28px;
            font-size: 14px;
            font-weight: 500;
        }

        .btn-primary:hover {
            background: #222;
        }

        /* Tesla æ¬¡è¦æŒ‰éˆ• â€” ç™½åº•é»‘æ¡† */
        .btn-secondary {
            background: var(--white);
            color: var(--black);
            padding: 13px 28px;
            border: 1px solid var(--black);
            font-size: 14px;
        }

        .btn-secondary:hover {
            background: var(--gray-100);
        }

        /* å°å‹æŒ‰éˆ• */
        .btn-sm {
            padding: 9px 18px;
            font-size: 13px;
        }

        /* å±éšªæŒ‰éˆ• */
        .btn-danger {
            background: transparent;
            color: var(--red);
            padding: 13px 28px;
            border: 1px solid var(--red);
        }

        .btn-danger:hover {
            background: rgba(232, 33, 39, 0.06);
        }

        /* ç´…è‰²ä¸»æŒ‰éˆ• */
        .btn-red {
            background: var(--red);
            color: var(--white);
            padding: 13px 28px;
        }

        .btn-red:hover {
            background: var(--red-dark);
        }

        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
            letter-spacing: 0.3px;
        }

        .badge-green {
            background: rgba(62, 145, 66, 0.1);
            color: var(--green);
        }

        .badge-red {
            background: rgba(232, 33, 39, 0.1);
            color: var(--red);
        }

        .badge-gray {
            background: var(--gray-100);
            color: var(--gray-600);
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           KIOSK / è»Šä¸»ç«¯
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        #view-kiosk {
            flex-direction: column;
            background: var(--white);
        }

        /* â”€â”€ é ‚éƒ¨å°è¦½ â”€â”€ */
        .kiosk-nav {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px 24px;
            border-bottom: 1px solid var(--gray-200);
            position: relative;
        }

        /* â”€â”€ é ˜è™Ÿç•«é¢ â”€â”€ */
        #kiosk-landing {
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            min-height: 100dvh;
        }

        .hero-section {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 60px 24px 40px;
            text-align: center;
            background: var(--white);
        }

        .hero-eyebrow {
            font-size: 12px;
            font-weight: 500;
            letter-spacing: 2px;
            text-transform: uppercase;
            color: var(--gray-600);
            margin-bottom: 16px;
        }

        .hero-title {
            font-size: clamp(28px, 7vw, 48px);
            font-weight: 300;
            color: var(--black);
            letter-spacing: -0.5px;
            line-height: 1.15;
            margin-bottom: 12px;
        }

        .hero-subtitle {
            font-size: 16px;
            color: var(--gray-600);
            font-weight: 400;
            margin-bottom: 48px;
        }

        /* å¤§å‹CTAæŒ‰éˆ• â€” Teslaå®˜ç¶²é¢¨æ ¼ */
        .btn-cta {
            background: var(--black);
            color: var(--white);
            border: none;
            border-radius: var(--radius-sm);
            font-family: inherit;
            font-size: 15px;
            font-weight: 500;
            padding: 16px 48px;
            cursor: pointer;
            transition: var(--transition);
            letter-spacing: 0.3px;
            min-width: 220px;
            -webkit-tap-highlight-color: transparent;
        }

        .btn-cta:hover {
            background: #222;
            transform: translateY(-1px);
            box-shadow: var(--shadow);
        }

        .btn-cta:active {
            transform: scale(0.97) translateY(0);
        }

        .hero-note {
            margin-top: 20px;
            font-size: 12px;
            color: var(--gray-400);
        }

        /* åº•éƒ¨è³‡è¨Šæ¬„ */
        .kiosk-footer-bar {
            padding: 20px 24px;
            border-top: 1px solid var(--gray-200);
            text-align: center;
            font-size: 12px;
            color: var(--gray-400);
        }

        /* â”€â”€ ç­‰å¾…ç•«é¢ â”€â”€ */
        #kiosk-waiting {
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            min-height: 100dvh;
        }

        .waiting-nav {
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px 24px;
            border-bottom: 1px solid var(--gray-200);
        }

        .ticket-hero {
            width: 100%;
            padding: 48px 24px 32px;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            border-bottom: 1px solid var(--gray-200);
        }

        .ticket-label {
            font-size: 11px;
            font-weight: 600;
            letter-spacing: 3px;
            text-transform: uppercase;
            color: var(--gray-400);
            margin-bottom: 8px;
        }

        .ticket-number {
            font-size: clamp(72px, 20vw, 120px);
            font-weight: 300;
            color: var(--black);
            letter-spacing: -4px;
            line-height: 1;
        }

        .ticket-number-prefix {
            font-size: 0.35em;
            font-weight: 400;
            letter-spacing: 0;
            color: var(--gray-400);
            vertical-align: super;
            margin-right: 4px;
        }

        /* é€²åº¦æ¢ */
        .progress-wrap {
            width: 100%;
            max-width: 480px;
            padding: 0 24px;
            margin-top: 20px;
        }

        .progress-track {
            width: 100%;
            height: 2px;
            background: var(--gray-200);
            border-radius: 2px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: var(--black);
            border-radius: 2px;
            transition: width 0.8s ease;
            width: 0%;
        }

        /* çµ±è¨ˆå¡ç‰‡ */
        .stats-row {
            display: flex;
            width: 100%;
            border-top: 1px solid var(--gray-200);
        }

        .stat-item {
            flex: 1;
            padding: 24px 16px;
            text-align: center;
            border-right: 1px solid var(--gray-200);
        }

        .stat-item:last-child {
            border-right: none;
        }

        .stat-label {
            font-size: 10px;
            font-weight: 600;
            letter-spacing: 2px;
            text-transform: uppercase;
            color: var(--gray-400);
            margin-bottom: 6px;
        }

        .stat-value {
            font-size: 24px;
            font-weight: 300;
            color: var(--black);
            letter-spacing: -0.5px;
        }

        .stat-value.highlight {
            color: var(--red);
        }

        .stat-value.green {
            color: var(--green);
        }

        .wake-notice {
            margin: 20px 24px 0;
            padding: 14px 18px;
            background: var(--gray-100);
            border-radius: var(--radius);
            font-size: 12px;
            color: var(--gray-600);
            display: flex;
            align-items: center;
            gap: 10px;
            max-width: 480px;
            width: calc(100% - 48px);
        }

        .wake-notice-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: var(--green);
            flex-shrink: 0;
        }

        /* â”€â”€ å«è™Ÿç•«é¢ â”€â”€ */
        #kiosk-called {
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            min-height: 100dvh;
            text-align: center;
            padding: 40px 24px;
            background: var(--black);
            color: var(--white);
            animation: called-bg-pulse 2s ease-in-out infinite;
        }

        @keyframes called-bg-pulse {

            0%,
            100% {
                background: #171a20;
            }

            50% {
                background: #1f0507;
            }
        }

        .called-badge {
            display: inline-block;
            background: var(--red);
            color: var(--white);
            font-size: 11px;
            font-weight: 600;
            letter-spacing: 3px;
            text-transform: uppercase;
            padding: 8px 20px;
            border-radius: 20px;
            margin-bottom: 32px;
            animation: called-badge-appear 0.5s ease;
        }

        @keyframes called-badge-appear {
            from {
                transform: scale(0.8);
                opacity: 0;
            }

            to {
                transform: scale(1);
                opacity: 1;
            }
        }

        .called-title {
            font-size: clamp(28px, 8vw, 48px);
            font-weight: 300;
            letter-spacing: -1px;
            line-height: 1.2;
            margin-bottom: 8px;
        }

        .called-sub {
            font-size: 16px;
            color: rgba(255, 255, 255, 0.5);
            margin-bottom: 48px;
        }

        .called-number {
            font-size: clamp(80px, 22vw, 140px);
            font-weight: 200;
            letter-spacing: -6px;
            line-height: 1;
            color: var(--white);
        }

        .called-number-hash {
            font-size: 0.35em;
            font-weight: 400;
            color: rgba(255, 255, 255, 0.4);
            letter-spacing: 0;
            vertical-align: super;
            margin-right: 4px;
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           ADMIN / ç®¡ç†ç«¯
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        #view-admin {
            flex-direction: column;
            min-height: 100vh;
            background: var(--white);
        }

        /* â”€â”€ å¯†ç¢¼é– â”€â”€ */
        #admin-lock {
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            gap: 28px;
            padding: 24px;
            text-align: center;
        }

        .admin-lock-title {
            font-size: 22px;
            font-weight: 300;
            letter-spacing: -0.5px;
            margin-top: 16px;
        }

        .admin-lock-sub {
            font-size: 14px;
            color: var(--gray-600);
        }

        .input-field {
            width: 100%;
            max-width: 320px;
            padding: 13px 16px;
            background: var(--white);
            border: 1px solid var(--gray-200);
            border-radius: var(--radius-sm);
            color: var(--black);
            font-size: 15px;
            font-family: inherit;
            outline: none;
            transition: var(--transition);
        }

        .input-field:focus {
            border-color: var(--black);
        }

        .input-group {
            display: flex;
            gap: 8px;
            width: 100%;
            max-width: 320px;
        }

        .input-group .input-field {
            flex: 1;
            max-width: none;
        }

        .pwd-error {
            color: var(--red);
            font-size: 12px;
            display: none;
        }

        /* â”€â”€ ç®¡ç†é¢æ¿ â”€â”€ */
        #admin-panel {
            flex-direction: column;
            min-height: 100vh;
        }

        .admin-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 32px;
            height: 64px;
            border-bottom: 1px solid var(--gray-200);
            background: var(--white);
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .admin-header-title {
            font-size: 15px;
            font-weight: 500;
            color: var(--black);
        }

        .admin-body {
            padding: 32px;
            flex: 1;
            max-width: 800px;
            margin: 0 auto;
            width: 100%;
        }

        /* çµ±è¨ˆå¡ç‰‡ */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1px;
            background: var(--gray-200);
            border: 1px solid var(--gray-200);
            border-radius: var(--radius);
            overflow: hidden;
            margin-bottom: 40px;
        }

        .stat-card {
            background: var(--white);
            padding: 28px 24px;
            text-align: center;
        }

        .stat-card-label {
            font-size: 11px;
            font-weight: 600;
            letter-spacing: 2px;
            text-transform: uppercase;
            color: var(--gray-400);
            margin-bottom: 8px;
        }

        .stat-card-value {
            font-size: 48px;
            font-weight: 200;
            letter-spacing: -2px;
            color: var(--black);
        }

        .stat-card-value.red {
            color: var(--red);
        }

        .stat-card-value.amber {
            color: var(--amber);
        }

        /* å€å¡Š */
        .admin-section {
            margin-bottom: 40px;
        }

        .admin-section-title {
            font-size: 11px;
            font-weight: 600;
            letter-spacing: 2px;
            text-transform: uppercase;
            color: var(--gray-400);
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 1px solid var(--gray-200);
        }

        .action-row {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            align-items: center;
        }

        .batch-input {
            width: 64px;
            padding: 9px 10px;
            background: var(--white);
            border: 1px solid var(--gray-200);
            border-radius: var(--radius-sm);
            color: var(--black);
            font-size: 14px;
            text-align: center;
            font-family: inherit;
            outline: none;
            transition: var(--transition);
        }

        .batch-input:focus {
            border-color: var(--black);
        }

        /* QR Section */
        .qr-section {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            gap: 16px;
        }

        .qr-box {
            padding: 16px;
            background: var(--white);
            border: 1px solid var(--gray-200);
            border-radius: var(--radius);
            display: inline-block;
        }

        .qr-url {
            font-size: 12px;
            color: var(--gray-400);
            word-break: break-all;
        }

        /* Admin footer */
        .admin-footer {
            padding: 16px 32px;
            border-top: 1px solid var(--gray-200);
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-size: 12px;
            color: var(--gray-400);
        }

        .connection-indicator {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .status-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
        }

        .status-dot.online {
            background: var(--green);
        }

        .status-dot.offline {
            background: var(--red);
        }

        /* Divider */
        .divider {
            height: 1px;
            background: var(--gray-200);
            margin: 32px 0;
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           TV DISPLAY / é›»è¦–çœ‹æ¿
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        #view-tv {
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background: var(--black);
            color: var(--white);
            position: relative;
            overflow: hidden;
        }

        /* ç´°å¾®èƒŒæ™¯ç´‹ç† */
        #view-tv::before {
            content: '';
            position: absolute;
            inset: 0;
            background:
                radial-gradient(ellipse at 50% 50%, rgba(255, 255, 255, 0.02) 0%, transparent 70%);
            pointer-events: none;
        }

        .tv-header {
            position: absolute;
            top: 48px;
            left: 0;
            right: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 12px;
        }

        .tv-header-line {
            width: 32px;
            height: 1px;
            background: rgba(255, 255, 255, 0.2);
        }

        .tv-sub {
            font-size: 13px;
            font-weight: 400;
            letter-spacing: 6px;
            text-transform: uppercase;
            color: rgba(255, 255, 255, 0.4);
        }

        .tv-main {
            text-align: center;
            z-index: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .tv-eyebrow {
            font-size: 13px;
            font-weight: 500;
            letter-spacing: 6px;
            text-transform: uppercase;
            color: rgba(255, 255, 255, 0.4);
            margin-bottom: 8px;
        }

        .tv-number {
            font-size: clamp(140px, 28vw, 300px);
            font-weight: 200;
            line-height: 1;
            letter-spacing: -8px;
            color: var(--white);
            transition: opacity 0.3s, transform 0.3s;
        }

        .tv-number.flip {
            animation: tv-flip 0.5s cubic-bezier(0.22, 1, 0.36, 1);
        }

        @keyframes tv-flip {
            0% {
                opacity: 0;
                transform: translateY(24px);
            }

            100% {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .tv-next-row {
            margin-top: 16px;
            font-size: 16px;
            color: rgba(255, 255, 255, 0.3);
            letter-spacing: 1px;
        }

        .tv-next-row span {
            color: rgba(255, 255, 255, 0.6);
            font-weight: 500;
        }

        .tv-footer {
            position: absolute;
            bottom: 48px;
            left: 0;
            right: 0;
            display: flex;
            justify-content: center;
            gap: 60px;
        }

        .tv-stat {
            text-align: center;
        }

        .tv-stat-label {
            font-size: 10px;
            font-weight: 600;
            letter-spacing: 3px;
            text-transform: uppercase;
            color: rgba(255, 255, 255, 0.3);
            margin-bottom: 4px;
        }

        .tv-stat-value {
            font-size: 28px;
            font-weight: 300;
            color: rgba(255, 255, 255, 0.8);
            letter-spacing: -1px;
        }

        /* åº•éƒ¨ç´°ç·š */
        .tv-footer-line {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--red);
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           Modal
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .modal-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            z-index: 100;
            align-items: center;
            justify-content: center;
            padding: 24px;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal-box {
            background: var(--white);
            border-radius: var(--radius-lg);
            padding: 40px 32px;
            max-width: 400px;
            width: 100%;
            text-align: center;
            box-shadow: var(--shadow-lg);
        }

        .modal-icon {
            font-size: 32px;
            margin-bottom: 16px;
        }

        .modal-box h3 {
            font-size: 20px;
            font-weight: 400;
            letter-spacing: -0.3px;
            margin-bottom: 10px;
        }

        .modal-box p {
            color: var(--gray-600);
            margin-bottom: 28px;
            font-size: 14px;
            line-height: 1.6;
        }

        .modal-actions {
            display: flex;
            gap: 10px;
            justify-content: center;
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           Animations
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .fade-in {
            animation: fadeIn 0.4s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(8px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           Phase 4: Waiting Screen Enhancements
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .waiting-card {
            margin: 12px 24px;
            padding: 16px 20px;
            background: var(--gray-100);
            border-radius: var(--radius);
            max-width: 480px;
            width: calc(100% - 48px);
        }

        .waiting-card-title {
            font-weight: 600;
            color: var(--black);
            margin-bottom: 10px;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .delivery-list-scroll {
            max-height: 200px;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }

        .delivery-list-scroll::-webkit-scrollbar {
            width: 4px;
        }

        .delivery-list-scroll::-webkit-scrollbar-track {
            background: transparent;
        }

        .delivery-list-scroll::-webkit-scrollbar-thumb {
            background: var(--gray-300);
            border-radius: 4px;
        }

        .dl-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
        }

        .dl-table th {
            text-align: left;
            color: var(--gray-500);
            font-weight: 500;
            font-size: 11px;
            padding: 4px 8px 8px;
            border-bottom: 1px solid var(--gray-200);
            letter-spacing: 0.5px;
        }

        .dl-table td {
            padding: 6px 8px;
            color: var(--gray-700);
            border-bottom: 1px solid var(--gray-100);
        }

        .dl-table td:first-child {
            color: var(--red);
            font-weight: 600;
            width: 36px;
        }

        .dl-table td:nth-child(2) {
            color: var(--gray-500);
            font-size: 12px;
            width: 48px;
        }

        .waiting-map-img {
            width: 100%;
            border-radius: var(--radius);
            margin-top: 4px;
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           Order Search + Map Highlight
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .search-section {
            margin: 16px 24px;
            max-width: 480px;
            width: calc(100% - 48px);
        }

        .search-card {
            background: var(--gray-100);
            border-radius: var(--radius);
            padding: 16px 20px;
        }

        .search-card-title {
            font-weight: 600;
            font-size: 14px;
            color: var(--black);
            margin-bottom: 10px;
        }

        .search-input-row {
            display: flex;
            gap: 8px;
        }

        .search-input {
            flex: 1;
            padding: 12px 14px;
            border: 1.5px solid var(--gray-200);
            border-radius: var(--radius);
            font-size: 15px;
            font-family: 'Inter', sans-serif;
            color: var(--black);
            background: var(--white);
            outline: none;
            transition: border-color 0.2s;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .search-input:focus {
            border-color: var(--red);
        }

        .search-input::placeholder {
            color: var(--gray-400);
            text-transform: none;
            letter-spacing: 0;
            font-size: 13px;
        }

        .search-btn {
            padding: 12px 20px;
            background: var(--black);
            color: var(--white);
            border: none;
            border-radius: var(--radius);
            font-size: 14px;
            font-weight: 500;
            font-family: 'Inter', sans-serif;
            cursor: pointer;
            white-space: nowrap;
        }

        .search-btn:active {
            opacity: 0.7;
        }

        /* Result */
        .search-result {
            margin-top: 12px;
            padding: 12px 16px;
            border-radius: var(--radius);
            display: none;
        }

        .search-result.found {
            display: flex;
            align-items: center;
            gap: 16px;
            background: linear-gradient(135deg, rgba(232, 33, 39, 0.06), rgba(232, 33, 39, 0.02));
            border: 1px solid rgba(232, 33, 39, 0.15);
        }

        .search-result.not-found {
            display: block;
            background: var(--gray-100);
            border: 1px solid var(--gray-200);
        }

        .result-spot {
            font-size: 15px;
            font-weight: 700;
            color: var(--red);
            white-space: nowrap;
        }

        .result-spot-label {
            font-size: 13px;
            color: var(--gray-500);
            white-space: nowrap;
        }

        .result-name {
            font-size: 15px;
            color: var(--black);
            font-weight: 500;
        }

        .result-not-found-text {
            font-size: 14px;
            color: var(--gray-600);
        }

        /* Interactive Map */
        .map-interactive {
            position: relative;
            margin-top: 12px;
            border-radius: var(--radius);
            overflow: hidden;
            background: #000;
        }

        .map-interactive img {
            width: 100%;
            display: block;
        }

        .spot-marker {
            position: absolute;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            transform: translate(-50%, -50%);
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .spot-marker.active {
            display: none;
        }
    </style>
</head>

<body>

    <!-- CONFIG ERROR -->
    <div id="screen-error">
        <h1>Firebase å°šæœªè¨­å®š</h1>
        <p>è«‹é–‹å•Ÿ <strong>index.html</strong>ï¼Œæ‰¾åˆ° <code>firebaseConfig</code> å€å¡Šï¼Œå¡«å…¥æ‚¨çš„ Firebase è¨­å®šå€¼ã€‚</p>
        <code>const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "...",
    databaseURL: "...",
    ...
};</code>
        <p style="margin-top:16px;font-size:13px;">è©³ç´°æ­¥é©Ÿè«‹åƒè€ƒ <strong>SETUP_GUIDE.md</strong></p>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         KIOSK / è»Šä¸»ç«¯
         â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div id="view-kiosk" class="view">

        <!-- é ˜è™Ÿ -->
        <div id="kiosk-landing" class="screen active">
            <div class="kiosk-nav">
                <span style="font-size:15px;font-weight:500;letter-spacing:1px;">Tesla å°åŒ—äº¤ä»˜ä¸­å¿ƒ</span>
            </div>

            <div class="hero-section">
                <p class="hero-eyebrow">Tesla å°åŒ—äº¤ä»˜ä¸­å¿ƒ</p>
                <h1 class="hero-title">æ­¡è¿è’è‡¨</h1>
                <p class="hero-subtitle">è«‹é ˜å–æ‚¨çš„å ±åˆ°è™Ÿç¢¼ç‰Œ</p>

                <button class="btn-cta" id="btnTakeTicket" onclick="takeTicket()">
                    é ˜å–è™Ÿç¢¼ç‰Œ
                </button>

                <p class="hero-note">é»æ“Šå¾Œè«‹ä¿æŒé é¢é–‹å•Ÿä»¥æ¥æ”¶é€šçŸ¥</p>
                <p
                    style="margin-top:16px;font-size:13px;color:var(--gray-600);max-width:300px;line-height:1.7;text-align:center;">
                    è‹¥å¤šäººå‰ä¾†äº¤è»Šï¼Œè«‹ä¸€ä½ä»£è¡¨æŠ½å–å³å¯
                </p>
            </div>

            <!-- è¨‚å–®æŸ¥è»Šä½ï¼ˆé ˜è™Ÿé é¢ï¼‰ -->
            <div class="search-section">
                <div class="search-card">
                    <div class="search-card-title">ğŸ” è¼¸å…¥è¨‚å–®ç·¨è™ŸæŸ¥è©¢è»Šä½</div>
                    <div class="search-input-row">
                        <input class="search-input" id="searchInputLanding" type="text" placeholder="ä¾‹ï¼šRN123456789"
                            maxlength="11" inputmode="text" autocomplete="off"
                            onkeydown="if(event.key==='Enter')searchSpot('landing')">
                        <button class="search-btn" onclick="searchSpot('landing')">æŸ¥è©¢</button>
                    </div>
                    <div class="search-result" id="searchResultLanding"></div>

                </div>
            </div>

            <div class="kiosk-footer-bar">
                Â© Tesla å°åŒ—äº¤ä»˜ä¸­å¿ƒå«è™Ÿç³»çµ±
            </div>
        </div>

        <!-- ç­‰å¾…ä¸­ -->
        <div id="kiosk-waiting" class="screen">
            <div class="waiting-nav">
                <span style="font-size:15px;font-weight:500;letter-spacing:1px;">Tesla å°åŒ—äº¤ä»˜ä¸­å¿ƒ</span>
            </div>

            <div class="ticket-hero fade-in">
                <div class="ticket-label">æ‚¨çš„è™Ÿç¢¼</div>
                <div class="ticket-number">
                    <span class="ticket-number-prefix">#</span><span id="myNumber">â€”</span>
                </div>
                <div style="font-size:12px; color:var(--gray-500); margin-top:6px; line-height:1.6; text-align:center;">
                    æ­¤ç‚ºå ±åˆ°é †åºï¼Œéè»Šä½è™Ÿç¢¼<br>è»Šä½è™Ÿç¢¼è«‹ç”±ä¸‹æ–¹è¼¸å…¥ RN æŸ¥è©¢
                </div>
            </div>

            <div class="progress-wrap" style="margin-top:24px;">
                <div class="progress-track">
                    <div class="progress-fill" id="progressBar"></div>
                </div>
            </div>

            <div class="stats-row fade-in" style="max-width:480px;width:100%;margin-top:4px;">
                <div class="stat-item">
                    <div class="stat-label">ç›®å‰å«è™Ÿ</div>
                    <div class="stat-value highlight" id="kioskCurrent">#0</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">å‰æ–¹ç­‰å¾…</div>
                    <div class="stat-value" id="kioskAhead">â€”</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">é ä¼°ç­‰å¾…</div>
                    <div class="stat-value green" id="kioskETA">â€”</div>
                </div>
            </div>

            <div class="wake-notice" id="wakeLockHint">
                <div class="wake-notice-dot"></div>
                <span>ç‚ºäº†æ¥æ”¶å«è™Ÿé€šçŸ¥ï¼Œè«‹ä¿æŒè¢å¹•æ†äº®</span>
            </div>

            <div
                style="margin:16px 24px 24px;padding:16px 20px;background:var(--gray-100);border-radius:var(--radius);font-size:13px;color:var(--gray-600);line-height:1.9;max-width:480px;width:calc(100% - 48px);">
                <div style="font-weight:600;color:var(--black);margin-bottom:6px;">è«‹æº–å‚™ä»¥ä¸‹è­‰ä»¶ä»¥é ˜å–è³‡æ–™å®Œæˆå ±åˆ°</div>
                <div>å€‹äººæˆ¶ï¼šè¨‚è³¼äºº æˆ– è»Šè¼›ç™»è¨˜äºº ä¹‹<strong>ç¬¬äºŒè­‰ä»¶</strong></div>
                <div style="margin-top:4px;">å…¬å¸æˆ¶ï¼šè¨‚è³¼äºº<strong>èº«åˆ†è­‰</strong> æˆ– <strong>å…¬å¸åç‰‡</strong></div>
            </div>

            <!-- Phase 4: å ±åˆ°åå–® -->
            <div class="waiting-card" id="waitingDeliveryCard" style="display:none;">
                <div class="waiting-card-title">ğŸ“‹ æœ¬å ´æ¬¡å ±åˆ°åå–®</div>
                <div class="delivery-list-scroll">
                    <table class="dl-table">
                        <thead>
                            <tr>
                                <th>è»Šä½</th>
                                <th>æ™‚é–“</th>
                                <th>å§“å</th>
                            </tr>
                        </thead>
                        <tbody id="waitingDeliveryBody"></tbody>
                    </table>
                </div>
            </div>

            <!-- è¨‚å–®æŸ¥è»Šä½ï¼ˆç­‰å¾…é é¢ï¼‰ -->
            <div class="search-section"
                style="margin-left:0; margin-right:0; width:100%; max-width:480px; padding:0 24px;">
                <div class="search-card">
                    <div class="search-card-title">ğŸ” è¼¸å…¥è¨‚å–®ç·¨è™ŸæŸ¥è©¢è»Šä½</div>
                    <div class="search-input-row">
                        <input class="search-input" id="searchInputWaiting" type="text" placeholder="ä¾‹ï¼šRN123456789"
                            maxlength="11" inputmode="text" autocomplete="off"
                            onkeydown="if(event.key==='Enter')searchSpot('waiting')">
                        <button class="search-btn" onclick="searchSpot('waiting')">æŸ¥è©¢</button>
                    </div>
                    <div class="search-result" id="searchResultWaiting"></div>

                </div>
            </div>

            <!-- Phase 4: äº¤è»Šä½ç½®åœ– -->
            <div class="waiting-card">
                <div class="waiting-card-title">B4 å°è¦½æŒ‡å¼•</div>
                <img src="b4_map.png" alt="B4 äº¤è»Šä½ç½®åœ–" class="waiting-map-img"
                    onerror="this.parentElement.style.display='none'">
            </div>

        </div>

        <!-- å«è™Ÿå•¦ -->
        <div id="kiosk-called" class="screen">
            <div class="called-badge">è«‹å‰å¾€å ±åˆ°</div>
            <div class="called-title">è¼ªåˆ°æ‚¨äº†</div>
            <div class="called-sub">è«‹è‡³é–€å£é»‘é¾è™• | æ’éšŠå ±åˆ°é ˜å–è³‡æ–™</div>
            <div class="called-number">
                <span class="called-number-hash">#</span><span id="calledMyNumber">â€”</span>
            </div>
            <!-- è»Šä½è³‡è¨Šï¼ˆè‹¥æœ‰æŸ¥è©¢éï¼‰ -->
            <div id="calledSpotInfo"
                style="display:none; margin-top:16px; padding:12px 20px; background:rgba(232,33,39,0.06); border:1px solid rgba(232,33,39,0.15); border-radius:10px; text-align:center;">
                <div style="font-size:13px; color:#999; margin-bottom:4px;">æ‚¨çš„è»Šä½</div>
                <div style="display:flex; align-items:center; justify-content:center; gap:8px;">
                    <span id="calledSpotNum" style="font-size:15px; font-weight:700; color:#E82127;"></span>
                    <span style="color:#ccc;">|</span>
                    <span id="calledSpotName" style="font-size:15px; color:#999; font-weight:500;"></span>
                </div>
            </div>
        </div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         ADMIN / ç®¡ç†ç«¯
         â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div id="view-admin" class="view">

        <!-- å¯†ç¢¼ -->
        <div id="admin-lock" class="screen active">
            <div>
                <div class="admin-lock-title">ç®¡ç†å¾Œå°</div>
                <div class="admin-lock-sub" style="margin-top:4px;">è«‹è¼¸å…¥ç®¡ç†å¯†ç¢¼</div>
            </div>
            <div class="input-group">
                <input type="password" class="input-field" id="adminPwd" placeholder="å¯†ç¢¼"
                    onkeydown="if(event.key==='Enter')adminLogin()">
                <button class="btn btn-primary" onclick="adminLogin()">é€²å…¥</button>
            </div>
            <p class="pwd-error" id="pwdError">å¯†ç¢¼éŒ¯èª¤ï¼Œè«‹é‡è©¦</p>
        </div>

        <!-- å¾Œå°é¢æ¿ -->
        <div id="admin-panel" class="screen">
            <div class="admin-header">
                <span class="admin-header-title">å«è™Ÿç®¡ç†</span>
                <span class="badge badge-green" id="adminSession">å ´æ¬¡é€²è¡Œä¸­</span>
            </div>

            <div class="admin-body">
                <!-- çµ±è¨ˆ -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-card-label">å·²é ˜è™Ÿ</div>
                        <div class="stat-card-value" id="statTotal">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card-label">å·²å«è™Ÿ</div>
                        <div class="stat-card-value red" id="statCalled">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card-label">ç­‰å¾…ä¸­</div>
                        <div class="stat-card-value amber" id="statWaiting">0</div>
                    </div>
                </div>

                <!-- å«è™Ÿæ“ä½œ -->
                <div class="admin-section">
                    <div class="admin-section-title">å«è™Ÿæ“ä½œ</div>
                    <div class="action-row" style="margin-bottom:12px;">
                        <button class="btn btn-primary" style="padding:16px 40px;font-size:15px;" onclick="callNext(1)">
                            å«ä¸‹ä¸€è™Ÿ
                        </button>
                    </div>
                    <div class="action-row" style="margin-top:16px;align-items:center;gap:8px;">
                        <span style="font-size:13px;color:var(--gray-600);">æ‰¹æ¬¡å«è™Ÿ</span>
                        <button class="btn btn-secondary btn-sm" onclick="callNext(3)">+3</button>
                        <button class="btn btn-secondary btn-sm" onclick="callNext(5)">+5</button>
                        <button class="btn btn-secondary btn-sm" onclick="callNext(10)">+10</button>
                        <input type="number" class="batch-input" id="batchSize" value="1" min="1" max="60">
                        <button class="btn btn-secondary btn-sm" onclick="callNextCustom()">è‡ªè¨‚</button>
                    </div>
                </div>

                <!-- QR Code -->
                <div class="admin-section">
                    <div class="admin-section-title">è»Šä¸»ç«¯ QR Code</div>
                    <div class="qr-section">
                        <div class="qr-box" id="adminQR"></div>
                        <p class="qr-url" id="adminQRUrl">â€”</p>
                        <p style="font-size:12px;color:var(--gray-400);margin-top:4px;">
                            åˆ—å°æ­¤ QR Code æ”¾ç½®æ–¼å…¥å£è™•ï¼Œè»Šä¸»æƒæå³å¯é ˜è™Ÿ
                        </p>
                    </div>
                </div>

                <!-- å®¢æˆ¶æŸ¥è©¢ç´€éŒ„ -->
                <div class="admin-section">
                    <div class="admin-section-title">å®¢æˆ¶æŸ¥è©¢ç´€éŒ„</div>
                    <div id="lookupTableContainer"
                        style="max-height:240px;overflow-y:auto;border:1px solid var(--gray-200);border-radius:8px;">
                        <table style="width:100%;border-collapse:collapse;font-size:13px;">
                            <thead>
                                <tr style="background:var(--gray-100);position:sticky;top:0;">
                                    <th
                                        style="padding:8px 10px;text-align:left;font-weight:600;border-bottom:1px solid var(--gray-200);">
                                        å ±åˆ°è™Ÿ</th>
                                    <th
                                        style="padding:8px 10px;text-align:left;font-weight:600;border-bottom:1px solid var(--gray-200);">
                                        è»Šä½</th>
                                    <th
                                        style="padding:8px 10px;text-align:left;font-weight:600;border-bottom:1px solid var(--gray-200);">
                                        å§“å</th>
                                    <th
                                        style="padding:8px 10px;text-align:left;font-weight:600;border-bottom:1px solid var(--gray-200);">
                                        RN</th>
                                </tr>
                            </thead>
                            <tbody id="lookupTableBody">
                                <tr>
                                    <td colspan="4" style="padding:16px;text-align:center;color:var(--gray-400);">å°šç„¡æŸ¥è©¢ç´€éŒ„
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <p style="font-size:12px;color:var(--gray-400);margin-top:6px;">è»Šä¸»æŸ¥è©¢ RN å¾Œè‡ªå‹•è¨˜éŒ„æ–¼æ­¤</p>
                </div>

                <!-- å ´æ¬¡ç®¡ç† -->
                <div class="admin-section">
                    <div class="admin-section-title">å ´æ¬¡ç®¡ç†</div>
                    <button class="btn btn-danger" onclick="showResetModal()">é‡è¨­å ´æ¬¡</button>
                    <p style="font-size:12px;color:var(--gray-400);margin-top:10px;">
                        æ¸…é™¤æ‰€æœ‰è™Ÿç¢¼è³‡æ–™ï¼Œå¾ç¬¬ 1 è™Ÿé‡æ–°é–‹å§‹
                    </p>
                </div>
            </div>

            <div class="admin-footer">
                <div class="connection-indicator">
                    <div class="status-dot" id="fbStatusDot"></div>
                    <span id="fbStatusText">é€£ç·šä¸­â€¦</span>
                </div>
                <span>Tesla Queue System v2.0</span>
            </div>
        </div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         TV DISPLAY / é›»è¦–çœ‹æ¿
         â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div id="view-tv" class="view">
        <div class="tv-header">
            <div class="tv-header-line"></div>
            <div class="tv-sub">äº¤ ä»˜ ä¸­ å¿ƒ</div>
        </div>

        <div class="tv-main">
            <div class="tv-eyebrow">ç›® å‰ å« è™Ÿ</div>
            <div class="tv-number" id="tvNumber">0</div>
            <div class="tv-next-row" id="tvNext"></div>
        </div>

        <div class="tv-footer">
            <div class="tv-stat">
                <div class="tv-stat-label">å·²é ˜è™Ÿ</div>
                <div class="tv-stat-value" id="tvTotal">0</div>
            </div>
            <div class="tv-stat">
                <div class="tv-stat-label">ç­‰å¾…ä¸­</div>
                <div class="tv-stat-value" id="tvWaiting">0</div>
            </div>
        </div>

        <div class="tv-footer-line"></div>
    </div>

    <!-- é‡è¨­ç¢ºèª Modal -->
    <div class="modal-overlay" id="resetModal">
        <div class="modal-box">
            <div class="modal-icon">âš ï¸</div>
            <h3>ç¢ºèªé‡è¨­å ´æ¬¡ï¼Ÿ</h3>
            <p>é€™å°‡æ¸…é™¤æ‰€æœ‰å·²é ˜è™Ÿç¢¼èˆ‡å«è™Ÿé€²åº¦ã€‚æ­¤æ“ä½œç„¡æ³•å¾©åŸã€‚</p>
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="hideResetModal()">å–æ¶ˆ</button>
                <button class="btn btn-red" onclick="resetQueue()">ç¢ºèªé‡è¨­</button>
            </div>
        </div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         JavaScript
         â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <script>
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // ğŸ”¥ Firebase è¨­å®š â€” è«‹å¡«å…¥æ‚¨çš„ Firebase å°ˆæ¡ˆè¨­å®š
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        const firebaseConfig = {
            apiKey: "AIzaSyCZzriWUnBIPKd9MuiJd5Ym0T7wKit9ul4",
            authDomain: "new-tesla-queue.firebaseapp.com",
            databaseURL: "https://new-tesla-queue-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "new-tesla-queue",
            storageBucket: "new-tesla-queue.firebasestorage.app",
            messagingSenderId: "612392646704",
            appId: "1:612392646704:web:667dd0784c72af409695f5"
        };

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // ç®¡ç†å¯†ç¢¼ (å¯è‡ªç”±ä¿®æ”¹)
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        const ADMIN_PASSWORD = '350019';

        const AVG_SERVICE_MIN = 2;
        const COUNTER_COUNT = 3;

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // å…¨åŸŸè®Šæ•¸
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        let db = null;
        let queueRef = null;
        let currentMode = 'kiosk';
        let myTicketNumber = null;
        let prevCalledUpTo = 0;
        let wakeLock = null;
        let audioCtx = null;

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // åˆå§‹åŒ–
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        (function init() {
            const params = new URLSearchParams(window.location.search);
            currentMode = params.get('mode') || 'kiosk';

            if (!firebaseConfig.apiKey || firebaseConfig.apiKey === 'YOUR_API_KEY' ||
                !firebaseConfig.databaseURL || firebaseConfig.databaseURL === 'YOUR_DATABASE_URL') {
                document.getElementById('screen-error').classList.add('active');
                return;
            }

            try {
                firebase.initializeApp(firebaseConfig);
                db = firebase.database();
                queueRef = db.ref('queue');
            } catch (e) {
                document.getElementById('screen-error').classList.add('active');
                return;
            }

            const viewEl = document.getElementById('view-' + currentMode);
            if (viewEl) {
                viewEl.classList.add('active');
            } else {
                document.getElementById('view-kiosk').classList.add('active');
                currentMode = 'kiosk';
            }

            switch (currentMode) {
                case 'kiosk': initKiosk(); break;
                case 'admin': initAdmin(); break;
                case 'tv': initTV(); break;
            }
        })();

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // ğŸ« KIOSK / è»Šä¸»ç«¯
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        function initKiosk() {
            queueRef.on('value', (snap) => {
                const data = snap.val() || {};
                const calledUpTo = data.calledUpTo || 0;
                const nextTicket = data.nextTicket || 1;
                const sessionId = data.sessionId || '';
                const totalTickets = nextTicket - 1;
                const localSession = localStorage.getItem('tq_session');

                if (localSession && sessionId !== localSession) {
                    localStorage.removeItem('tq_ticket');
                    localStorage.removeItem('tq_session');
                    myTicketNumber = null;
                    prevCalledUpTo = 0;
                    switchKioskScreen('kiosk-landing');
                    return;
                }

                if (myTicketNumber !== null) {
                    updateKioskWaiting(calledUpTo, totalTickets);
                }
            });

            const saved = localStorage.getItem('tq_ticket');
            const savedSession = localStorage.getItem('tq_session');
            if (saved && savedSession) {
                queueRef.child('sessionId').once('value', (snap) => {
                    if (snap.val() === savedSession) {
                        myTicketNumber = parseInt(saved);
                        document.getElementById('myNumber').textContent = String(myTicketNumber).padStart(3, '0');
                        document.getElementById('calledMyNumber').textContent = String(myTicketNumber).padStart(3, '0');
                        switchKioskScreen('kiosk-waiting');
                        requestWakeLock();
                    } else {
                        localStorage.removeItem('tq_ticket');
                        localStorage.removeItem('tq_session');
                    }
                });
            }

            // Phase 4: ç›£è½äº¤è»Šåå–® â†’ é¡¯ç¤ºåœ¨ç­‰å¾…ç•«é¢ + æœå°‹è³‡æ–™
            db.ref('board/deliveryList').on('value', (snap) => {
                const text = snap.val();
                renderWaitingDeliveryList(text);
                updateSearchData(text);
            });
        }

        // Phase 4: æ¸²æŸ“ç­‰å¾…ç•«é¢å ±åˆ°åå–®
        function renderWaitingDeliveryList(text) {
            const card = document.getElementById('waitingDeliveryCard');
            const tbody = document.getElementById('waitingDeliveryBody');
            if (!text || typeof text !== 'string') { card.style.display = 'none'; return; }
            const now = new Date();
            const currentHour = now.getHours();
            const lines = text.split('\n');
            let html = '';
            let count = 0;
            lines.forEach(line => {
                const parts = line.split('\t');
                if (parts.length >= 2) {
                    const time = parts[0].trim();
                    const spot = parts[1].trim();
                    const name = parts[2] ? parts[2].trim() : '';
                    // ç¯©é¸ç›®å‰å ´æ¬¡ï¼ˆåŒä¸€å°æ™‚ï¼‰
                    const h = parseInt(time.split(':')[0]);
                    if (h === currentHour || (h === currentHour + 1 && now.getMinutes() >= 50)) {
                        html += `<tr><td>${spot}</td><td>${time}</td><td>${name}</td></tr>`;
                        count++;
                    }
                }
            });
            if (count > 0) {
                tbody.innerHTML = html;
                card.style.display = '';
            } else {
                card.style.display = 'none';
            }
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // ğŸ” è¨‚å–®æŸ¥è»Šä½ + åœ°åœ–é»äº®
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        let deliverySearchData = [];
        let lastSearchResult = null;

        // B4 è»Šä½åº§æ¨™ (% ä½ç½®ï¼Œå°æ‡‰ b4_map.png)
        const SPOT_POSITIONS = {
            // Zone A: ä¸Šæ–¹å€åŸŸ
            1: { x: 38, y: 37 }, 2: { x: 43, y: 37 }, 3: { x: 48, y: 37 }, 4: { x: 53, y: 37 }, 5: { x: 58, y: 37 },
            6: { x: 63, y: 37 }, 7: { x: 68, y: 37 }, 8: { x: 73, y: 37 }, 9: { x: 78, y: 37 }, 10: { x: 83, y: 37 },
            11: { x: 83, y: 28 }, 12: { x: 78, y: 28 }, 13: { x: 73, y: 28 }, 14: { x: 68, y: 28 }, 15: { x: 63, y: 28 },
            16: { x: 58, y: 28 }, 17: { x: 53, y: 28 }, 18: { x: 48, y: 28 }, 19: { x: 43, y: 28 }, 20: { x: 38, y: 28 },
            // Zone B: å³ä¸Š + å³å´
            21: { x: 95, y: 34 }, 22: { x: 95, y: 29 }, 23: { x: 95, y: 24 }, 24: { x: 95, y: 18 },
            25: { x: 90, y: 9 }, 26: { x: 85, y: 9 }, 27: { x: 80, y: 9 }, 28: { x: 75, y: 9 }, 29: { x: 70, y: 9 }, 30: { x: 58, y: 9 },
            // Zone C: ä¸­é–“å€åŸŸ
            31: { x: 52, y: 55 }, 32: { x: 57, y: 55 }, 33: { x: 62, y: 55 }, 34: { x: 67, y: 55 }, 35: { x: 72, y: 55 }, 36: { x: 77, y: 55 }, 37: { x: 82, y: 55 },
            38: { x: 82, y: 62 }, 39: { x: 77, y: 62 }, 50: { x: 67, y: 62 }, 51: { x: 62, y: 62 }, 52: { x: 57, y: 62 }, 53: { x: 52, y: 62 }, 54: { x: 39, y: 60 },
            // Zone D: æœ€ä¸‹æ’
            55: { x: 37, y: 87 }, 56: { x: 42, y: 87 }, 57: { x: 47, y: 87 }, 58: { x: 52, y: 87 }, 59: { x: 57, y: 87 }, 60: { x: 62, y: 87 },
            61: { x: 67, y: 87 }, 62: { x: 72, y: 87 }, 63: { x: 77, y: 87 }, 64: { x: 82, y: 87 }, 65: { x: 87, y: 87 }, 66: { x: 92, y: 87 },
            // å³å´ç›´åˆ—
            67: { x: 95, y: 64 }, 68: { x: 95, y: 61 }, 69: { x: 95, y: 57 }, 70: { x: 95, y: 53 }
        };

        // æ›´æ–°æœå°‹ç”¨è³‡æ–™ï¼ˆå¾ Firebase deliveryList åŒæ­¥ï¼‰
        function updateSearchData(text) {
            if (!text || typeof text !== 'string') return;
            deliverySearchData = [];
            text.split('\n').forEach(line => {
                const parts = line.split('\t');
                if (parts.length >= 3) {
                    deliverySearchData.push({
                        time: parts[0].trim(),
                        spot: parts[1].trim(),
                        name: parts[2].trim(),
                        order: parts[3] ? parts[3].trim().toUpperCase() : ''
                    });
                }
            });
        }

        function searchSpot(page) {
            const input = document.getElementById('searchInput' + (page === 'landing' ? 'Landing' : 'Waiting'));
            const resultEl = document.getElementById('searchResult' + (page === 'landing' ? 'Landing' : 'Waiting'));
            const mapEl = document.getElementById('searchMap' + (page === 'landing' ? 'Landing' : 'Waiting'));
            const query = input.value.trim().toUpperCase();

            if (!query) { input.focus(); return; }

            // æœå°‹è¨‚å–®
            const found = deliverySearchData.find(d => d.order === query);

            if (found) {
                resultEl.className = 'search-result found';
                resultEl.innerHTML = `
                    <div class="result-spot-label">æ‚¨çš„è»Šä½</div>
                    <div class="result-spot">${found.spot} è™Ÿ</div>
                    <div style="color:#ccc;">|</div>
                    <div class="result-name">${found.name}</div>
                `;
                // å„²å­˜æœå°‹çµæœï¼Œå«è™Ÿé ä¹Ÿé¡¯ç¤º
                lastSearchResult = { spot: found.spot, name: found.name };
                // å¯«å…¥ Firebase è®“ç®¡ç†å¾Œå°å¯ä»¥çœ‹åˆ°
                try {
                    const ticketNum = myTicketNumber || 'â€”';
                    db.ref('queue/lookups').push({
                        ticket: ticketNum,
                        spot: found.spot,
                        name: found.name,
                        rn: query,
                        ts: Date.now()
                    });
                } catch (e) { console.log('Lookup write failed:', e); }
                // éš±è—åœ°åœ–
                mapEl.style.display = 'none';
            } else {
                resultEl.className = 'search-result not-found';
                resultEl.innerHTML = '<div class="result-not-found-text">âŒ æŸ¥ç„¡æ­¤è¨‚å–®ç·¨è™Ÿï¼Œè«‹ç¢ºèªå¾Œé‡è©¦</div>';
                mapEl.style.display = 'none';
            }
        }

        function highlightSpotOnMap(mapContainer, spotNum) {
            // ç§»é™¤èˆŠçš„ marker
            mapContainer.querySelectorAll('.spot-marker').forEach(m => m.remove());
            const pos = SPOT_POSITIONS[spotNum];
            if (!pos) return;
            const marker = document.createElement('div');
            marker.className = 'spot-marker active';
            marker.style.left = pos.x + '%';
            marker.style.top = pos.y + '%';
            mapContainer.appendChild(marker);
        }

        function takeTicket() {
            if (myTicketNumber !== null) return;
            const btn = document.getElementById('btnTakeTicket');
            btn.style.pointerEvents = 'none';
            btn.style.opacity = '0.6';
            btn.textContent = 'é ˜å–ä¸­â€¦';

            queueRef.child('nextTicket').transaction((current) => {
                return (current || 1) + 1;
            }, (error, committed, snapshot) => {
                if (error || !committed) {
                    btn.style.pointerEvents = '';
                    btn.style.opacity = '';
                    btn.textContent = 'é ˜å–è™Ÿç¢¼ç‰Œ';
                    alert('é ˜è™Ÿå¤±æ•—ï¼Œè«‹é‡è©¦');
                    return;
                }

                myTicketNumber = snapshot.val() - 1;
                const formatted = String(myTicketNumber).padStart(3, '0');

                queueRef.child('sessionId').once('value', (snap) => {
                    let sid = snap.val();
                    if (!sid) {
                        sid = Date.now().toString(36);
                        queueRef.child('sessionId').set(sid);
                    }
                    localStorage.setItem('tq_ticket', myTicketNumber);
                    localStorage.setItem('tq_session', sid);
                });

                document.getElementById('myNumber').textContent = formatted;
                document.getElementById('calledMyNumber').textContent = formatted;
                switchKioskScreen('kiosk-waiting');
                requestWakeLock();

                if (navigator.vibrate) navigator.vibrate(100);
            });
        }

        function updateKioskWaiting(calledUpTo, totalTickets) {
            if (myTicketNumber === null) return;

            const ahead = Math.max(0, myTicketNumber - calledUpTo - 1);
            const isCalled = myTicketNumber <= calledUpTo;

            document.getElementById('kioskCurrent').textContent = '#' + String(calledUpTo).padStart(3, '0');
            document.getElementById('kioskAhead').textContent = isCalled ? 'â€”' : ahead + ' äºº';

            const etaMin = Math.ceil((ahead / COUNTER_COUNT) * AVG_SERVICE_MIN);
            document.getElementById('kioskETA').textContent = isCalled ? 'â€”' : ('~' + etaMin + ' åˆ†');

            const progress = totalTickets > 0 ? (calledUpTo / totalTickets) * 100 : 0;
            document.getElementById('progressBar').style.width = Math.min(100, progress) + '%';

            if (isCalled && calledUpTo > prevCalledUpTo) {
                switchKioskScreen('kiosk-called');
                // è‹¥æœ‰æŸ¥éè¨‚å–®ï¼Œé¡¯ç¤ºè»Šä½è³‡è¨Š
                if (lastSearchResult) {
                    document.getElementById('calledSpotNum').textContent = lastSearchResult.spot + ' è™Ÿ';
                    document.getElementById('calledSpotName').textContent = lastSearchResult.name;
                    document.getElementById('calledSpotInfo').style.display = '';
                }
                playNotificationSound();
                if (navigator.vibrate) navigator.vibrate([500, 200, 500, 200, 500]);
            }

            prevCalledUpTo = calledUpTo;
        }

        function switchKioskScreen(id) {
            document.querySelectorAll('#view-kiosk .screen').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        }

        async function requestWakeLock() {
            const hint = document.getElementById('wakeLockHint');
            if (!('wakeLock' in navigator)) {
                hint.querySelector('span').textContent = 'æ‚¨çš„ç€è¦½å™¨ä¸æ”¯æ´è¢å¹•æ†äº®ï¼Œè«‹æ‰‹å‹•ä¿æŒè¢å¹•é–‹å•Ÿ';
                return;
            }
            try {
                wakeLock = await navigator.wakeLock.request('screen');
                hint.querySelector('span').textContent = 'è¢å¹•æ†äº®å·²å•Ÿç”¨ï¼Œè«‹å‹¿é—œé–‰æ­¤é é¢';
                hint.querySelector('.wake-notice-dot').style.background = 'var(--green)';
                wakeLock.addEventListener('release', () => {
                    hint.querySelector('span').textContent = 'è¢å¹•æ†äº®å·²ä¸­æ–·ï¼Œè«‹å‹¿é–å®šæ‰‹æ©Ÿ';
                    hint.querySelector('.wake-notice-dot').style.background = 'var(--amber)';
                });
            } catch (e) {
                hint.querySelector('span').textContent = 'ç„¡æ³•å•Ÿç”¨è¢å¹•æ†äº®ï¼Œè«‹æ‰‹å‹•ä¿æŒè¢å¹•é–‹å•Ÿ';
            }
        }

        document.addEventListener('visibilitychange', () => {
            if (document.visibilityState === 'visible' && currentMode === 'kiosk' && myTicketNumber !== null) {
                requestWakeLock();
            }
        });

        function playNotificationSound() {
            try {
                if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
                [0, 0.3, 0.6].forEach(delay => {
                    const osc = audioCtx.createOscillator();
                    const gain = audioCtx.createGain();
                    osc.connect(gain);
                    gain.connect(audioCtx.destination);
                    osc.frequency.value = 880;
                    osc.type = 'sine';
                    gain.gain.setValueAtTime(0.3, audioCtx.currentTime + delay);
                    gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + delay + 0.2);
                    osc.start(audioCtx.currentTime + delay);
                    osc.stop(audioCtx.currentTime + delay + 0.2);
                });
            } catch (e) { }
        }

        function playTVChime() {
            try {
                if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
                const notes = [523.25, 659.25, 783.99];
                notes.forEach((freq, i) => {
                    const osc = audioCtx.createOscillator();
                    const gain = audioCtx.createGain();
                    osc.connect(gain);
                    gain.connect(audioCtx.destination);
                    osc.frequency.value = freq;
                    osc.type = 'sine';
                    const t = audioCtx.currentTime + i * 0.2;
                    gain.gain.setValueAtTime(0.2, t);
                    gain.gain.exponentialRampToValueAtTime(0.01, t + 0.4);
                    osc.start(t);
                    osc.stop(t + 0.4);
                });
            } catch (e) { }
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // ğŸ–¥ï¸ ADMIN / ç®¡ç†ç«¯
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        function initAdmin() {
            db.ref('.info/connected').on('value', (snap) => {
                const dot = document.getElementById('fbStatusDot');
                const txt = document.getElementById('fbStatusText');
                if (snap.val() === true) {
                    dot.className = 'status-dot online';
                    txt.textContent = 'Firebase å·²é€£ç·š';
                } else {
                    dot.className = 'status-dot offline';
                    txt.textContent = 'é€£ç·šä¸­æ–·';
                }
            });

            queueRef.on('value', (snap) => {
                const data = snap.val() || {};
                const calledUpTo = data.calledUpTo || 0;
                const nextTicket = data.nextTicket || 1;
                const total = nextTicket - 1;
                const waiting = Math.max(0, total - calledUpTo);
                document.getElementById('statTotal').textContent = total;
                document.getElementById('statCalled').textContent = calledUpTo;
                document.getElementById('statWaiting').textContent = waiting;
            });

            // ç›£è½å®¢æˆ¶æŸ¥è©¢ç´€éŒ„
            queueRef.child('lookups').on('value', (snap) => {
                const data = snap.val();
                const tbody = document.getElementById('lookupTableBody');
                if (!data) {
                    tbody.innerHTML = '<tr><td colspan="4" style="padding:16px;text-align:center;color:var(--gray-400);">å°šç„¡æŸ¥è©¢ç´€éŒ„</td></tr>';
                    return;
                }
                const rows = Object.values(data).sort((a, b) => (b.ts || 0) - (a.ts || 0));
                let html = '';
                rows.forEach(r => {
                    html += `<tr style="border-bottom:1px solid var(--gray-100);">
                        <td style="padding:6px 10px;">#${r.ticket}</td>
                        <td style="padding:6px 10px;font-weight:600;color:var(--red);">${r.spot} è™Ÿ</td>
                        <td style="padding:6px 10px;">${r.name}</td>
                        <td style="padding:6px 10px;font-family:monospace;font-size:12px;">${r.rn}</td>
                    </tr>`;
                });
                tbody.innerHTML = html;
            });
        }

        function adminLogin() {
            const pwd = document.getElementById('adminPwd').value;
            if (pwd === ADMIN_PASSWORD) {
                switchAdminScreen('admin-panel');
                generateQR();
            } else {
                document.getElementById('pwdError').style.display = 'block';
                document.getElementById('adminPwd').value = '';
                if (navigator.vibrate) navigator.vibrate(200);
            }
        }

        function switchAdminScreen(id) {
            document.querySelectorAll('#view-admin .screen').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        }

        function callNext(count) {
            if (!queueRef) return;
            queueRef.child('calledUpTo').transaction((current) => (current || 0) + count);
        }

        function callNextCustom() {
            const n = parseInt(document.getElementById('batchSize').value) || 1;
            callNext(n);
        }

        function generateQR() {
            const container = document.getElementById('adminQR');
            const urlDisplay = document.getElementById('adminQRUrl');
            const kioskUrl = (window.location.origin + window.location.pathname).replace(/\?.*$/, '');

            container.innerHTML = '';
            try {
                new QRCode(container, {
                    text: kioskUrl,
                    width: 200,
                    height: 200,
                    colorDark: '#000000',
                    colorLight: '#ffffff',
                    correctLevel: QRCode.CorrectLevel.H
                });
            } catch (e) {
                container.innerHTML = '<p style="color:var(--gray-400)">QR Code ç”¢ç”Ÿå¤±æ•—</p>';
            }
            urlDisplay.textContent = kioskUrl;
        }

        function showResetModal() { document.getElementById('resetModal').classList.add('active'); }
        function hideResetModal() { document.getElementById('resetModal').classList.remove('active'); }

        function resetQueue() {
            hideResetModal();
            queueRef.set({
                calledUpTo: 0,
                nextTicket: 1,
                sessionId: Date.now().toString(36) + Math.random().toString(36).substr(2, 5)
            });
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // ğŸ“º TV DISPLAY / é›»è¦–çœ‹æ¿
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        function initTV() {
            let prevNumber = 0;

            queueRef.on('value', (snap) => {
                const data = snap.val() || {};
                const calledUpTo = data.calledUpTo || 0;
                const nextTicket = data.nextTicket || 1;
                const total = nextTicket - 1;
                const waiting = Math.max(0, total - calledUpTo);

                const numEl = document.getElementById('tvNumber');
                if (calledUpTo !== prevNumber) {
                    numEl.classList.remove('flip');
                    void numEl.offsetWidth;
                    numEl.textContent = calledUpTo;
                    numEl.classList.add('flip');

                    if (calledUpTo > prevNumber && prevNumber > 0) {
                        playTVChime();
                    }
                    prevNumber = calledUpTo;
                }

                const nextEl = document.getElementById('tvNext');
                if (calledUpTo < total) {
                    const nextNums = [];
                    for (let i = calledUpTo + 1; i <= Math.min(calledUpTo + 3, total); i++) {
                        nextNums.push(String(i).padStart(3, '0'));
                    }
                    nextEl.innerHTML = 'ä¸‹ä¸€ä½ï¼š<span>' + nextNums.join('ã€') + '</span>';
                } else {
                    nextEl.innerHTML = '';
                }

                document.getElementById('tvTotal').textContent = total;
                document.getElementById('tvWaiting').textContent = waiting;
            });

            document.addEventListener('click', function initAudio() {
                if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
                document.removeEventListener('click', initAudio);
            }, { once: true });
        }
    </script>

</body>

</html>



